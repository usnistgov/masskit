
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Imports and Parameter Settings &#8212; masskit 1.0.0-2-gf71e19b documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
<script>
$(document).ready(function(){
  // Mark external (non-nist.gov) A tags with class "external"
  //If the adress start with https and ends with nist.gov
  var re_nist = new RegExp('^https?:\/\/((^\/)*\.)*nist\\.gov(\/|$)');
  //Regex to find address that start with https
  var re_absolute_address = new RegExp('^((https?:)?\/\/)');
  $("a").each(function(){
    var url=$(this).attr('href');
    if(re_nist.test(url) || !re_absolute_address.test(url)){
      $(this).addClass('local');
    }else{
      //This a href appears to be external, so tag it
      $(this).addClass('external');
    }
  });
  // Add leaveNotice to external A elements
  $('a.external').leaveNotice();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">masskit 1.0.0-2-gf71e19b documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Imports and Parameter Settings</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Imports-and-Parameter-Settings">
<h1>Imports and Parameter Settings<a class="headerlink" href="#Imports-and-Parameter-Settings" title="Permalink to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pyarrow</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="kn">import</span> <span class="nn">pyarrow.parquet</span> <span class="k">as</span> <span class="nn">pq</span>
<span class="kn">import</span> <span class="nn">pyarrow.compute</span> <span class="k">as</span> <span class="nn">pc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">DataStructs</span>
<span class="c1">#sys.path.append(&#39;/home/djs10/gitlab/msdc_services/libraries&#39;)</span>
<span class="kn">from</span> <span class="nn">masskit.spectrum</span> <span class="kn">import</span> <span class="n">spectrum</span>

<span class="c1"># Parameters</span>
<span class="n">MIN_INTENSITY_PERCENT</span><span class="o">=</span><span class="mf">0.05</span>
<span class="n">USE_MZ_ZERO</span><span class="o">=</span><span class="kc">True</span>
<span class="n">FILENAME</span> <span class="o">=</span> <span class="s1">&#39;/data/aiomics/search/libraries/hr_msms_nist2020_v42_0.parquet&#39;</span>
<span class="n">OUTFILENAME</span> <span class="o">=</span> <span class="s1">&#39;/data/aiomics/search/libraries/hr_msms_nist2020_v42_0_fingerprints.parquet&#39;</span>
<span class="c1">#FILENAME = &#39;/data/aiomics/search/libraries/small.parquet&#39;</span>
<span class="c1">#OUTFILENAME = &#39;/data/aiomics/search/libraries/small_fingerprints.parquet&#39;</span>
</pre></div>
</div>
</div>
</section>
<section id="Load-Data">
<h1>Load Data<a class="headerlink" href="#Load-Data" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="c1"># ion_mode = p</span>
<span class="c1"># set</span>
<span class="n">only_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">]</span>
<span class="n">filter_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;ion_mode&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">)</span> <span class="p">]</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">only_cols</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span><span class="o">.</span><span class="n">combine_chunks</span><span class="p">()</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 1.85 s, sys: 941 ms, total: 2.79 s
Wall time: 4.4 s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>mz</th>
      <th>intensity</th>
      <th>set</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1035166</td>
      <td>[45.96, 597.48, 598.5, 599.5, 600.52, 951.77, ...</td>
      <td>[46.35, 51.85, 41.36, 669.33, 40.76, 51.85, 40...</td>
      <td>dev</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1035167</td>
      <td>[597.5, 599.5, 1449.98, 1450.98, 1465.98, 1466...</td>
      <td>[50.95, 683.32, 999.0, 43.56, 46.35, 50.65, 56...</td>
      <td>train</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1035168</td>
      <td>[537.39, 599.5, 600.51, 1449.98, 1467.0]</td>
      <td>[55.94, 999.0, 42.26, 853.85, 139.16]</td>
      <td>train</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1035169</td>
      <td>[597.46, 598.5, 599.51, 600.49, 1448.92, 1449....</td>
      <td>[41.86, 45.15, 999.0, 43.86, 41.86, 452.85, 18...</td>
      <td>train</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1035170</td>
      <td>[598.49, 599.5, 600.5, 1449.97]</td>
      <td>[47.85, 999.0, 85.51, 336.46]</td>
      <td>train</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>751903</th>
      <td>3485111</td>
      <td>[150.0546, 151.0386, 152.0703, 154.0496, 156.0...</td>
      <td>[34.07, 49.75, 2.9, 4.1, 3.3, 8.79, 19.28, 25....</td>
      <td>train</td>
    </tr>
    <tr>
      <th>751904</th>
      <td>3485112</td>
      <td>[150.0545, 151.0385, 154.0496, 166.0495, 167.0...</td>
      <td>[60.94, 82.12, 10.39, 10.79, 18.18, 35.96, 28....</td>
      <td>train</td>
    </tr>
    <tr>
      <th>751905</th>
      <td>3485113</td>
      <td>[150.0547, 151.0386, 168.0653, 178.0494, 197.0...</td>
      <td>[148.45, 134.47, 18.78, 35.96, 35.26, 40.56, 9...</td>
      <td>train</td>
    </tr>
    <tr>
      <th>751906</th>
      <td>3485114</td>
      <td>[150.0547, 151.0387, 264.2682, 265.2721]</td>
      <td>[316.88, 334.07, 999.0, 92.71]</td>
      <td>train</td>
    </tr>
    <tr>
      <th>751907</th>
      <td>3485115</td>
      <td>[186.0757, 197.0439, 204.0863, 205.09, 214.071...</td>
      <td>[18.08, 5.39, 96.1, 5.99, 3.0, 6.59, 4.2, 14.1...</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
<p>751908 rows × 4 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table</span><span class="o">.</span><span class="n">column_names</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;id&#39;,
 &#39;charge&#39;,
 &#39;ev&#39;,
 &#39;instrument&#39;,
 &#39;instrument_type&#39;,
 &#39;ion_mode&#39;,
 &#39;ionization&#39;,
 &#39;name&#39;,
 &#39;nce&#39;,
 &#39;intensity&#39;,
 &#39;product_massinfo&#39;,
 &#39;mz&#39;,
 &#39;precursor_intensity&#39;,
 &#39;precursor_massinfo&#39;,
 &#39;precursor_mz&#39;,
 &#39;spectrum_fp&#39;,
 &#39;spectrum_fp_count&#39;,
 &#39;aromatic_rings&#39;,
 &#39;collision_energy&#39;,
 &#39;collision_gas&#39;,
 &#39;column&#39;,
 &#39;ecfp4&#39;,
 &#39;ecfp4_count&#39;,
 &#39;estimated_ri&#39;,
 &#39;estimated_ri_error&#39;,
 &#39;exact_mass&#39;,
 &#39;exact_mw&#39;,
 &#39;experimental_ri&#39;,
 &#39;experimental_ri_data&#39;,
 &#39;experimental_ri_error&#39;,
 &#39;formula&#39;,
 &#39;has_2d&#39;,
 &#39;has_conformer&#39;,
 &#39;has_tms&#39;,
 &#39;hba&#39;,
 &#39;hbd&#39;,
 &#39;inchi_key&#39;,
 &#39;inchi_key_orig&#39;,
 &#39;insource_voltage&#39;,
 &#39;isomeric_smiles&#39;,
 &#39;mol&#39;,
 &#39;num_atoms&#39;,
 &#39;num_undef_double&#39;,
 &#39;num_undef_stereo&#39;,
 &#39;rotatable_bonds&#39;,
 &#39;sample_inlet&#39;,
 &#39;set&#39;,
 &#39;smiles&#39;,
 &#39;stdnp&#39;,
 &#39;stdnp_data&#39;,
 &#39;stdnp_error&#39;,
 &#39;stdpolar&#39;,
 &#39;stdpolar_data&#39;,
 &#39;stdpolar_error&#39;,
 &#39;synonyms&#39;,
 &#39;tpsa&#39;,
 &#39;vial_id&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">only_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;exact_mass&quot;</span><span class="p">]</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">only_cols</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 1.51 s, sys: 744 ms, total: 2.26 s
Wall time: 1.81 s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>charge</th>
      <th>mz</th>
      <th>intensity</th>
      <th>exact_mass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1035166</td>
      <td>1</td>
      <td>[45.96, 597.48, 598.5, 599.5, 600.52, 951.77, ...</td>
      <td>[46.35, 51.85, 41.36, 669.33, 40.76, 51.85, 40...</td>
      <td>1448.97223</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1035167</td>
      <td>1</td>
      <td>[597.5, 599.5, 1449.98, 1450.98, 1465.98, 1466...</td>
      <td>[50.95, 683.32, 999.0, 43.56, 46.35, 50.65, 56...</td>
      <td>1448.97223</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1035168</td>
      <td>1</td>
      <td>[537.39, 599.5, 600.51, 1449.98, 1467.0]</td>
      <td>[55.94, 999.0, 42.26, 853.85, 139.16]</td>
      <td>1448.97223</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1035169</td>
      <td>1</td>
      <td>[597.46, 598.5, 599.51, 600.49, 1448.92, 1449....</td>
      <td>[41.86, 45.15, 999.0, 43.86, 41.86, 452.85, 18...</td>
      <td>1448.97223</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1035170</td>
      <td>1</td>
      <td>[598.49, 599.5, 600.5, 1449.97]</td>
      <td>[47.85, 999.0, 85.51, 336.46]</td>
      <td>1448.97223</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1007661</th>
      <td>3485111</td>
      <td>2</td>
      <td>[150.0546, 151.0386, 152.0703, 154.0496, 156.0...</td>
      <td>[34.07, 49.75, 2.9, 4.1, 3.3, 8.79, 19.28, 25....</td>
      <td>1383.82383</td>
    </tr>
    <tr>
      <th>1007662</th>
      <td>3485112</td>
      <td>2</td>
      <td>[150.0545, 151.0385, 154.0496, 166.0495, 167.0...</td>
      <td>[60.94, 82.12, 10.39, 10.79, 18.18, 35.96, 28....</td>
      <td>1383.82383</td>
    </tr>
    <tr>
      <th>1007663</th>
      <td>3485113</td>
      <td>2</td>
      <td>[150.0547, 151.0386, 168.0653, 178.0494, 197.0...</td>
      <td>[148.45, 134.47, 18.78, 35.96, 35.26, 40.56, 9...</td>
      <td>1383.82383</td>
    </tr>
    <tr>
      <th>1007664</th>
      <td>3485114</td>
      <td>2</td>
      <td>[150.0547, 151.0387, 264.2682, 265.2721]</td>
      <td>[316.88, 334.07, 999.0, 92.71]</td>
      <td>1383.82383</td>
    </tr>
    <tr>
      <th>1007665</th>
      <td>3485115</td>
      <td>2</td>
      <td>[186.0757, 197.0439, 204.0863, 205.09, 214.071...</td>
      <td>[18.08, 5.39, 96.1, 5.99, 3.0, 6.59, 4.2, 14.1...</td>
      <td>1383.82383</td>
    </tr>
  </tbody>
</table>
<p>1007666 rows × 5 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100000</span><span class="p">:</span><span class="mi">10000</span><span class="p">]</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>charge</th>
      <th>mz</th>
      <th>intensity</th>
      <th>exact_mass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1035166</td>
      <td>1</td>
      <td>[45.96, 597.48, 598.5, 599.5, 600.52, 951.77, ...</td>
      <td>[46.35, 51.85, 41.36, 669.33, 40.76, 51.85, 40...</td>
      <td>1448.972230</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1064281</td>
      <td>2</td>
      <td>[30.03, 44.05, 44.98, 45.06, 45.98, 47.99, 57....</td>
      <td>[12.89, 18.98, 370.03, 92.31, 11.09, 63.64, 36...</td>
      <td>152.044190</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1074623</td>
      <td>1</td>
      <td>[81.03, 112.05, 308.06]</td>
      <td>[27.37, 999.0, 161.84]</td>
      <td>307.056936</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1097402</td>
      <td>1</td>
      <td>[57.04, 57.07, 58.96, 85.04, 99.99, 118.07, 12...</td>
      <td>[20.38, 42.16, 82.22, 18.08, 52.45, 40.76, 30....</td>
      <td>261.111341</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1114460</td>
      <td>1</td>
      <td>[44.05, 59.048, 60.056, 70.065, 73.064, 86.071...</td>
      <td>[49.15, 55.54, 12.59, 95.8, 25.17, 52.65, 977....</td>
      <td>233.112404</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1140635</td>
      <td>1</td>
      <td>[50.015, 51.0228, 53.0385, 55.0178, 55.0542, 6...</td>
      <td>[28.17, 44.06, 11.69, 11.89, 9.59, 2.7, 17.08,...</td>
      <td>386.209324</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1156152</td>
      <td>1</td>
      <td>[55.018, 65.0387, 68.9971, 77.0384, 78.0464, 7...</td>
      <td>[10.39, 35.86, 3.2, 70.13, 29.57, 8.29, 521.98...</td>
      <td>358.120508</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1172453</td>
      <td>-2</td>
      <td>[62.9642, 77.9752, 78.9591, 92.0254, 96.9696, ...</td>
      <td>[1.0, 3.9, 999.0, 13.29, 71.33, 55.94, 1.8, 1....</td>
      <td>893.219673</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1188155</td>
      <td>1</td>
      <td>[65.0386, 91.0543]</td>
      <td>[502.1, 999.0]</td>
      <td>135.104799</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1203633</td>
      <td>-1</td>
      <td>[55.453, 57.0347, 59.014, 65.0397, 67.0553, 68...</td>
      <td>[1.5, 7.59, 29.47, 1.6, 1.7, 1.1, 4.9, 5.79, 1...</td>
      <td>374.209324</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>id</th>
      <td>1035166</td>
      <td>1064281</td>
      <td>1074623</td>
      <td>1097402</td>
      <td>1114460</td>
      <td>1140635</td>
      <td>1156152</td>
      <td>1172453</td>
      <td>1188155</td>
      <td>1203633</td>
    </tr>
    <tr>
      <th>charge</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>-2</td>
      <td>1</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>mz</th>
      <td>[45.96, 597.48, 598.5, 599.5, 600.52, 951.77, ...</td>
      <td>[30.03, 44.05, 44.98, 45.06, 45.98, 47.99, 57....</td>
      <td>[81.03, 112.05, 308.06]</td>
      <td>[57.04, 57.07, 58.96, 85.04, 99.99, 118.07, 12...</td>
      <td>[44.05, 59.048, 60.056, 70.065, 73.064, 86.071...</td>
      <td>[50.015, 51.0228, 53.0385, 55.0178, 55.0542, 6...</td>
      <td>[55.018, 65.0387, 68.9971, 77.0384, 78.0464, 7...</td>
      <td>[62.9642, 77.9752, 78.9591, 92.0254, 96.9696, ...</td>
      <td>[65.0386, 91.0543]</td>
      <td>[55.453, 57.0347, 59.014, 65.0397, 67.0553, 68...</td>
    </tr>
    <tr>
      <th>intensity</th>
      <td>[46.35, 51.85, 41.36, 669.33, 40.76, 51.85, 40...</td>
      <td>[12.89, 18.98, 370.03, 92.31, 11.09, 63.64, 36...</td>
      <td>[27.37, 999.0, 161.84]</td>
      <td>[20.38, 42.16, 82.22, 18.08, 52.45, 40.76, 30....</td>
      <td>[49.15, 55.54, 12.59, 95.8, 25.17, 52.65, 977....</td>
      <td>[28.17, 44.06, 11.69, 11.89, 9.59, 2.7, 17.08,...</td>
      <td>[10.39, 35.86, 3.2, 70.13, 29.57, 8.29, 521.98...</td>
      <td>[1.0, 3.9, 999.0, 13.29, 71.33, 55.94, 1.8, 1....</td>
      <td>[502.1, 999.0]</td>
      <td>[1.5, 7.59, 29.47, 1.6, 1.7, 1.1, 4.9, 5.79, 1...</td>
    </tr>
    <tr>
      <th>exact_mass</th>
      <td>1448.97223</td>
      <td>152.04419</td>
      <td>307.056936</td>
      <td>261.111341</td>
      <td>233.112404</td>
      <td>386.209324</td>
      <td>358.120508</td>
      <td>893.219673</td>
      <td>135.104799</td>
      <td>374.209324</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Using-NumPy-Array">
<h1>Using NumPy Array<a class="headerlink" href="#Using-NumPy-Array" title="Permalink to this heading">¶</a></h1>
<p>Defunct method of transforming an RDKit bitvec into a format suitable for storing in a pyarrow array. While the resulting filesize was smaller, everything else took longer and used more memory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># filename = OUTFILENAME+&quot;_numpy&quot;</span>
<span class="c1"># fingerprint_schema = pa.schema(</span>
<span class="c1">#     [</span>
<span class="c1">#         pa.field(&quot;id&quot;, pa.int64()),</span>
<span class="c1">#         pa.field(&quot;fingerprint_rep&quot;, pa.list_(pa.int8()))</span>
<span class="c1">#     ]</span>
<span class="c1"># )</span>
<span class="c1">#</span>
<span class="c1"># def bitvecToArrow(fp):</span>
<span class="c1">#     fp_numpy = np.zeros((0,), dtype=int)</span>
<span class="c1">#     DataStructs.ConvertToNumpyArray(fp, fp_numpy)</span>
<span class="c1">#     return fp_numpy</span>
<span class="c1">#</span>
<span class="c1"># def arrowToBitvec(fp):</span>
<span class="c1">#     bitstring=&quot;&quot;.join(fp.astype(str))</span>
<span class="c1">#     return DataStructs.cDataStructs.CreateFromBitString(bitstring)</span>
</pre></div>
</div>
</div>
</section>
<section id="Calc-fingerprints-and-store">
<h1>Calc fingerprints and store<a class="headerlink" href="#Calc-fingerprints-and-store" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>

<span class="n">fingerprint_schema</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">pa</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">int64</span><span class="p">()),</span>
        <span class="n">pa</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;fingerprint_rep&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">binary</span><span class="p">()),</span>
        <span class="n">pa</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">dictionary</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int8</span><span class="p">(),</span> <span class="n">pa</span><span class="o">.</span><span class="n">string</span><span class="p">()))</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">bitvecToArrow</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">cDataStructs</span><span class="o">.</span><span class="n">BitVectToBinaryText</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">arrowToBitvec</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">cDataStructs</span><span class="o">.</span><span class="n">CreateFromBinaryText</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fetch_mz</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">list_flatten</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;mz&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">list_flatten</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;intensity&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;mz&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>
    <span class="c1"># Filter by minimum intensity</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">MIN_INTENSITY_PERCENT</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">fetch_spectrum</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">list_flatten</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;mz&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">list_flatten</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;intensity&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">init_spectrum</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">mz</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calc_fingerprint</span><span class="p">(</span><span class="n">mz</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">calc_bit</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">ExplicitBitVect</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span>
    <span class="n">len_mz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">USE_MZ_ZERO</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_mz</span><span class="p">):</span>
            <span class="c1">#print(0, mz[i], calc_bit(0,mz[i]))</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">SetBit</span><span class="p">(</span><span class="n">calc_bit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mz</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_mz</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">len_mz</span><span class="p">):</span>
            <span class="c1">#print(mz[i], mz[j], calc_bit(mz[i],mz[j]))</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">SetBit</span><span class="p">(</span><span class="n">calc_bit</span><span class="p">(</span><span class="n">mz</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">mz</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">fp</span>

<span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fingerprints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">mz</span> <span class="o">=</span> <span class="n">fetch_mz</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">bitvecToArrow</span><span class="p">(</span><span class="n">calc_fingerprint</span><span class="p">(</span><span class="n">mz</span><span class="p">))</span>
    <span class="n">fingerprints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25000</span><span class="p">):</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">ids</span><span class="p">,</span> <span class="s2">&quot;fingerprint_rep&quot;</span><span class="p">:</span> <span class="n">fingerprints</span><span class="p">},</span> <span class="n">schema</span><span class="o">=</span><span class="n">fingerprint_schema</span><span class="p">))</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fingerprints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#print(sys.getsizeof(fp))</span>
    <span class="c1">#print(DataStructs.cDataStructs.BitVectToText(fp))</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">ids</span><span class="p">,</span> <span class="s2">&quot;fingerprint_rep&quot;</span><span class="p">:</span> <span class="n">fingerprints</span><span class="p">},</span> <span class="n">schema</span><span class="o">=</span><span class="n">fingerprint_schema</span><span class="p">))</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fingerprints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fp_table</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">concat_tables</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
<span class="c1">#fp_table = pa.table(</span>
<span class="c1">#    {</span>
<span class="c1">#        &quot;id&quot;: table.column(&quot;id&quot;),</span>
<span class="c1">#        &quot;fingerprint&quot;: fingerprints</span>
<span class="c1">#    }, schema=fingerprint_schema)</span>
<span class="c1">#fp_table.to_pandas()</span>
<span class="n">pq</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">fp_table</span><span class="p">,</span> <span class="n">OUTFILENAME</span><span class="p">,</span> <span class="n">row_group_size</span><span class="o">=</span><span class="mi">250000</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;2.0&quot;</span><span class="p">)</span>
<span class="n">fp_table</span><span class="o">.</span><span class="n">nbytes</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 9min 3s, sys: 834 ms, total: 9min 4s
Wall time: 9min 5s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1888793020
</pre></div></div>
</div>
</section>
<section id="Read-fingerprints-from-the-store-and-convert">
<h1>Read fingerprints from the store and convert<a class="headerlink" href="#Read-fingerprints-from-the-store-and-convert" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">fp_table2</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">OUTFILENAME</span><span class="p">)</span>
<span class="n">fp_df</span> <span class="o">=</span> <span class="n">fp_table2</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">fp_df</span> <span class="o">=</span> <span class="n">fp_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fingerprint</span><span class="o">=</span><span class="n">fp_df</span><span class="p">[</span><span class="s1">&#39;fingerprint_rep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">arrowToBitvec</span><span class="p">))</span>
<span class="n">fp_df</span> <span class="o">=</span> <span class="n">fp</span><span class="p">[[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;fingerprint&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;timed exec&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>

<span class="ansi-red-fg">TypeError</span>: byte indices must be integers or slices, not list
</pre></div></div>
</div>
</section>
<section id="Tanimoto-vs. Cosine">
<h1>Tanimoto vs. Cosine<a class="headerlink" href="#Tanimoto-vs. Cosine" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query_idx</span> <span class="o">=</span> <span class="mi">5400</span>
<span class="n">query_fp</span> <span class="o">=</span> <span class="n">fp_df</span><span class="p">[</span><span class="s1">&#39;fingerprint&#39;</span><span class="p">][</span><span class="n">query_idx</span><span class="p">]</span>
<span class="n">query_spec</span> <span class="o">=</span> <span class="n">fetch_spectrum</span><span class="p">(</span><span class="n">query_idx</span><span class="p">)</span>
<span class="n">query_spec</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/search_prototype_15_0.svg" src="_images/search_prototype_15_0.svg" /></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">fp_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">tanimoto</span><span class="o">=</span><span class="n">DataStructs</span><span class="o">.</span><span class="n">cDataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">query_fp</span><span class="p">,</span> <span class="n">fp_df</span><span class="p">[</span><span class="s1">&#39;fingerprint&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 1.11 s, sys: 15.9 ms, total: 1.13 s
Wall time: 1.13 s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">cosine_score</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">fetch_spectrum</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cosine_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query_spec</span><span class="o">.</span><span class="n">cosine_score</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cosine</span><span class="o">=</span><span class="n">cosine_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 2min 9s, sys: 25.1 ms, total: 2min 9s
Wall time: 2min 9s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;tanimoto&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>tanimoto</th>
      <th>cosine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1035166</td>
      <td>0.064935</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1035167</td>
      <td>0.102041</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1035168</td>
      <td>0.023810</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1035169</td>
      <td>0.025000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1035170</td>
      <td>0.026316</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>751903</th>
      <td>3485111</td>
      <td>0.026316</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>751904</th>
      <td>3485112</td>
      <td>0.024390</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>751905</th>
      <td>3485113</td>
      <td>0.024390</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>751906</th>
      <td>3485114</td>
      <td>0.024390</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>751907</th>
      <td>3485115</td>
      <td>0.032520</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>751908 rows × 3 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;tanimoto&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tanimoto</th>
      <th>cosine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>tanimoto</th>
      <td>1.000000</td>
      <td>0.039608</td>
    </tr>
    <tr>
      <th>cosine</th>
      <td>0.039608</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;tanimoto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/search_prototype_20_1.png" src="_images/search_prototype_20_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cosine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/search_prototype_21_1.png" src="_images/search_prototype_21_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tanimoto</span><span class="o">&gt;</span><span class="mf">0.3</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>tanimoto</th>
      <th>cosine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7.188000e+03</td>
      <td>7188.000000</td>
      <td>7188.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.220454e+06</td>
      <td>0.335725</td>
      <td>1.864883</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.800404e+05</td>
      <td>0.036164</td>
      <td>33.964300</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.054586e+06</td>
      <td>0.301075</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.448317e+06</td>
      <td>0.312500</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.887226e+06</td>
      <td>0.326531</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.238719e+06</td>
      <td>0.348485</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.479769e+06</td>
      <td>1.000000</td>
      <td>999.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">cosine</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>tanimoto</th>
      <th>cosine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.690000e+02</td>
      <td>169.000000</td>
      <td>169.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.057890e+06</td>
      <td>0.205028</td>
      <td>253.419188</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.665267e+03</td>
      <td>0.143237</td>
      <td>180.131876</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.054550e+06</td>
      <td>0.026316</td>
      <td>100.499669</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.055670e+06</td>
      <td>0.114286</td>
      <td>137.707436</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.056816e+06</td>
      <td>0.181818</td>
      <td>193.571781</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.059599e+06</td>
      <td>0.244898</td>
      <td>291.013025</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.068841e+06</td>
      <td>1.000000</td>
      <td>999.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Search-and-Score">
<h1>Search and Score<a class="headerlink" href="#Search-and-Score" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fp_df</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="n">query_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="o">.</span><span class="n">set</span><span class="o">==</span><span class="s1">&#39;test&#39;</span><span class="p">][[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;fingerprint&#39;</span><span class="p">,</span> <span class="s1">&#39;mz&#39;</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">]]</span>
<span class="n">db_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;train&#39;</span><span class="p">])][[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;fingerprint&#39;</span><span class="p">,</span> <span class="s1">&#39;mz&#39;</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">]]</span>
<span class="n">db_df</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 478 ms, sys: 25.1 ms, total: 503 ms
Wall time: 497 ms
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>fingerprint</th>
      <th>mz</th>
      <th>intensity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1035167</td>
      <td>[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[597.5, 599.5, 1449.98, 1450.98, 1465.98, 1466...</td>
      <td>[50.95, 683.32, 999.0, 43.56, 46.35, 50.65, 56...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1035168</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>[537.39, 599.5, 600.51, 1449.98, 1467.0]</td>
      <td>[55.94, 999.0, 42.26, 853.85, 139.16]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1035169</td>
      <td>[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[597.46, 598.5, 599.51, 600.49, 1448.92, 1449....</td>
      <td>[41.86, 45.15, 999.0, 43.86, 41.86, 452.85, 18...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1035170</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
      <td>[598.49, 599.5, 600.5, 1449.97]</td>
      <td>[47.85, 999.0, 85.51, 336.46]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1035171</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>[597.48, 599.5, 600.51, 1449.98]</td>
      <td>[40.56, 999.0, 40.06, 151.55]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>751903</th>
      <td>3485111</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0546, 151.0386, 152.0703, 154.0496, 156.0...</td>
      <td>[34.07, 49.75, 2.9, 4.1, 3.3, 8.79, 19.28, 25....</td>
    </tr>
    <tr>
      <th>751904</th>
      <td>3485112</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0545, 151.0385, 154.0496, 166.0495, 167.0...</td>
      <td>[60.94, 82.12, 10.39, 10.79, 18.18, 35.96, 28....</td>
    </tr>
    <tr>
      <th>751905</th>
      <td>3485113</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0547, 151.0386, 168.0653, 178.0494, 197.0...</td>
      <td>[148.45, 134.47, 18.78, 35.96, 35.26, 40.56, 9...</td>
    </tr>
    <tr>
      <th>751906</th>
      <td>3485114</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0547, 151.0387, 264.2682, 265.2721]</td>
      <td>[316.88, 334.07, 999.0, 92.71]</td>
    </tr>
    <tr>
      <th>751907</th>
      <td>3485115</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
      <td>[186.0757, 197.0439, 204.0863, 205.09, 214.071...</td>
      <td>[18.08, 5.39, 96.1, 5.99, 3.0, 6.59, 4.2, 14.1...</td>
    </tr>
  </tbody>
</table>
<p>736795 rows × 4 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fp_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>fingerprint_rep</th>
      <th>fingerprint</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1035166</td>
      <td>b'\x01\x06\x18\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1035167</td>
      <td>b'\x01\x06\x18\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1035168</td>
      <td>b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1035169</td>
      <td>b'\x01\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1035170</td>
      <td>b'\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>751903</th>
      <td>3485111</td>
      <td>b'\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>751904</th>
      <td>3485112</td>
      <td>b'\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>751905</th>
      <td>3485113</td>
      <td>b'\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>751906</th>
      <td>3485114</td>
      <td>b'\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>751907</th>
      <td>3485115</td>
      <td>b'\x00\x04\x10\x00\x00\x00\x00\x00\x00\x00\x00...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
    </tr>
  </tbody>
</table>
<p>751908 rows × 3 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fp_df</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="n">query_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="o">.</span><span class="n">set</span><span class="o">==</span><span class="s1">&#39;test&#39;</span><span class="p">][[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;fingerprint&#39;</span><span class="p">,</span> <span class="s1">&#39;mz&#39;</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">]]</span>
<span class="n">db_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;train&#39;</span><span class="p">])][[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;fingerprint&#39;</span><span class="p">,</span> <span class="s1">&#39;mz&#39;</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">db_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>fingerprint</th>
      <th>mz</th>
      <th>intensity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1035167</td>
      <td>[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[597.5, 599.5, 1449.98, 1450.98, 1465.98, 1466...</td>
      <td>[50.95, 683.32, 999.0, 43.56, 46.35, 50.65, 56...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1035168</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>[537.39, 599.5, 600.51, 1449.98, 1467.0]</td>
      <td>[55.94, 999.0, 42.26, 853.85, 139.16]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1035169</td>
      <td>[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[597.46, 598.5, 599.51, 600.49, 1448.92, 1449....</td>
      <td>[41.86, 45.15, 999.0, 43.86, 41.86, 452.85, 18...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1035170</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
      <td>[598.49, 599.5, 600.5, 1449.97]</td>
      <td>[47.85, 999.0, 85.51, 336.46]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1035171</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>[597.48, 599.5, 600.51, 1449.98]</td>
      <td>[40.56, 999.0, 40.06, 151.55]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>736790</th>
      <td>3485111</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0546, 151.0386, 152.0703, 154.0496, 156.0...</td>
      <td>[34.07, 49.75, 2.9, 4.1, 3.3, 8.79, 19.28, 25....</td>
    </tr>
    <tr>
      <th>736791</th>
      <td>3485112</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0545, 151.0385, 154.0496, 166.0495, 167.0...</td>
      <td>[60.94, 82.12, 10.39, 10.79, 18.18, 35.96, 28....</td>
    </tr>
    <tr>
      <th>736792</th>
      <td>3485113</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0547, 151.0386, 168.0653, 178.0494, 197.0...</td>
      <td>[148.45, 134.47, 18.78, 35.96, 35.26, 40.56, 9...</td>
    </tr>
    <tr>
      <th>736793</th>
      <td>3485114</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, ...</td>
      <td>[150.0547, 151.0387, 264.2682, 265.2721]</td>
      <td>[316.88, 334.07, 999.0, 92.71]</td>
    </tr>
    <tr>
      <th>736794</th>
      <td>3485115</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, ...</td>
      <td>[186.0757, 197.0439, 204.0863, 205.09, 214.071...</td>
      <td>[18.08, 5.39, 96.1, 5.99, 3.0, 6.59, 4.2, 14.1...</td>
    </tr>
  </tbody>
</table>
<p>736795 rows × 4 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">result_dfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">query_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">ts_df</span> <span class="o">=</span> <span class="n">db_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">tanimoto</span><span class="o">=</span><span class="n">DataStructs</span><span class="o">.</span><span class="n">cDataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;fingerprint&#39;</span><span class="p">],</span> <span class="n">db_df</span><span class="p">[</span><span class="s1">&#39;fingerprint&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;tanimoto&#39;</span><span class="p">)</span>
    <span class="n">ts_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;query_id&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

    <span class="n">query_spec</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">init_spectrum</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">mz</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">])</span>
    <span class="n">cosine_score</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ts_i</span><span class="p">,</span> <span class="n">ts_r</span> <span class="ow">in</span> <span class="n">ts_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">init_spectrum</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">mz</span><span class="o">=</span><span class="n">ts_r</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="n">ts_r</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">])</span>
        <span class="n">cosine_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query_spec</span><span class="o">.</span><span class="n">cosine_score</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
    <span class="n">ts_df</span> <span class="o">=</span> <span class="n">ts_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cosine</span><span class="o">=</span><span class="n">cosine_score</span><span class="p">)</span>

    <span class="n">result_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts_df</span><span class="p">[[</span><span class="s1">&#39;query_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;tanimoto&#39;</span><span class="p">,</span><span class="s1">&#39;cosine&#39;</span><span class="p">]])</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">result_dfs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">result_df</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 2h 36min 22s, sys: 45.4 s, total: 2h 37min 8s
Wall time: 2h 37min 17s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>query_id</th>
      <th>id</th>
      <th>tanimoto</th>
      <th>cosine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1035242</td>
      <td>1035241</td>
      <td>1.000000</td>
      <td>945.043355</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1035242</td>
      <td>1035242</td>
      <td>1.000000</td>
      <td>999.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1035242</td>
      <td>1035467</td>
      <td>1.000000</td>
      <td>945.043355</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1035242</td>
      <td>1035468</td>
      <td>1.000000</td>
      <td>999.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1035242</td>
      <td>1035243</td>
      <td>0.600000</td>
      <td>942.953953</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3746495</th>
      <td>3484604</td>
      <td>1145980</td>
      <td>0.085714</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3746496</th>
      <td>3484604</td>
      <td>1231464</td>
      <td>0.085714</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3746497</th>
      <td>3484604</td>
      <td>1806600</td>
      <td>0.085714</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3746498</th>
      <td>3484604</td>
      <td>3362043</td>
      <td>0.085714</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3746499</th>
      <td>3484604</td>
      <td>1062864</td>
      <td>0.083333</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>3746500 rows × 4 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;/data/aiomics/search/libraries/hr_msms_nist2020_v42_0_tanimoto-cosine.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result_df</span><span class="p">[[</span><span class="s1">&#39;tanimoto&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tanimoto</th>
      <th>cosine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>tanimoto</th>
      <td>1.000000</td>
      <td>0.630985</td>
    </tr>
    <tr>
      <th>cosine</th>
      <td>0.630985</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Imports and Parameter Settings</a></li>
<li><a class="reference internal" href="#Load-Data">Load Data</a></li>
<li><a class="reference internal" href="#Using-NumPy-Array">Using NumPy Array</a></li>
<li><a class="reference internal" href="#Calc-fingerprints-and-store">Calc fingerprints and store</a></li>
<li><a class="reference internal" href="#Read-fingerprints-from-the-store-and-convert">Read fingerprints from the store and convert</a></li>
<li><a class="reference internal" href="#Tanimoto-vs. Cosine">Tanimoto vs. Cosine</a></li>
<li><a class="reference internal" href="#Search-and-Score">Search and Score</a></li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/search_prototype.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">masskit 1.0.0-2-gf71e19b documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Imports and Parameter Settings</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>